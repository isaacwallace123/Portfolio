name: portfolio

networks:
  web:
    external: true

services:
  portfolio-backend:
    container_name: portfolio-backend
    image: ghcr.io/isaacwallace123/portfolio-backend:latest
    restart: unless-stopped
    networks: [web]
    expose:
      - "8080"
    environment:
      PORT: 8080
      PROMETHEUS_BASE_URL: ${PROMETHEUS_BASE_URL}
      DOCKER_HOST: ${DOCKER_HOST}
      PROXMOX_BASE_URL: ${PROXMOX_BASE_URL}
      PROXMOX_TOKEN_ID: ${PROXMOX_TOKEN_ID}
      PROXMOX_TOKEN_SECRET: ${PROXMOX_TOKEN_SECRET}
      UNRAID_IP_ADDRESS: ${UNRAID_IP_ADDRESS}
      PROXMOX_IP_ADDRESS: ${PROXMOX_IP_ADDRESS}
      INGRESS_IP_ADDRESS: ${INGRESS_IP_ADDRESS}
      API_KEY: ${API_KEY}
    volumes:
      - /mnt/user/appdata/portfolio/backend/config.yaml:/app/config.yaml:ro
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://127.0.0.1:8080/health"]
      interval: 20s
      timeout: 5s
      retries: 6
      start_period: 25s

  portfolio-frontend:
    container_name: portfolio-frontend
    image: ghcr.io/isaacwallace123/portfolio-frontend:latest
    restart: unless-stopped
    networks: [web]
    build:
      args:
        VITE_BACKEND_URL: ${VITE_BACKEND_URL}
    expose:
      - "3000"
    environment:
      PORT: 3000
    depends_on:
      - portfolio-backend
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:3000/"]
      interval: 30s
      timeout: 3s
      retries: 5
